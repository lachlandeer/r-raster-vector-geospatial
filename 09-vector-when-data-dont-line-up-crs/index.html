<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2018-04-06 21:35:58 +0000">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    
    <link rel="shortcut icon" type="image/x-icon" href="/favicon-dc.ico" />
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>Intro to Geospatial Data with R: Handling Spatial Projection & CRS in R</title>
  </head>
  <body>
    <div class="container">
      
<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="http://datacarpentry.org" class="pull-left">
        <img class="navbar-logo" src="../assets/img/dc-icon-black.svg" alt="Data Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../conduct/">Code of Conduct</a></li>

	
        
        <li><a href="../setup/">Setup</a></li>
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../01-raster-structure/">Intro to Raster Data in R</a></li>
            
            <li><a href="../02-raster-plot/">Plot Raster Data in R</a></li>
            
            <li><a href="../03-raster-reproject-in-r/">Reproject Raster Data in R</a></li>
            
            <li><a href="../04-raster-calculations-in-r/">Raster Calculations in R</a></li>
            
            <li><a href="../05-raster-multi-band-in-r/">Work With Multi-Band Rasters in R</a></li>
            
            <li><a href="../06-vector-open-shapefile-in-r/">Open and Plot Shapefiles in R</a></li>
            
            <li><a href="../07-vector-shapefile-attributes-in-r/">Explore and Plot by Shapefile Attributes</a></li>
            
            <li><a href="../08-vector-plot-shapefiles-custom-legend/">Plot Multiple Shapefiles in R</a></li>
            
            <li><a href="../09-vector-when-data-dont-line-up-crs/">Handling Spatial Projection & CRS in R</a></li>
            
            <li><a href="../10-vector-csv-to-shapefile-in-r/">Convert from .csv to a Shapefile in R</a></li>
            
            <li><a href="../11-vector-raster-integration/">Manipulate Raster Data in R</a></li>
            
            <li><a href="../12-time-series-raster/">Raster Time Series Data in R</a></li>
            
            <li><a href="../13-plot-time-series-rasters-in-r/">Plot Raster Time Series Data in R</a></li>
            
            <li><a href="../14-extract-ndvi-from-rasters-in-r/">Derive Values from Raster Time Series</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference/">Reference</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../license/">License</a></li>
	
	<li><a href="/edit/gh-pages/_episodes/09-vector-when-data-dont-line-up-crs.md">Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>


<div class="row">
  <div class="col-md-1">
    <h3>
      
      <a href="../08-vector-plot-shapefiles-custom-legend/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
    <h3 class="maintitle"><a href="../">Intro to Geospatial Data with R</a></h3>
    
  </div>
  <div class="col-md-1">
    <h3>
      
      <a href="../10-vector-csv-to-shapefile-in-r/"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Handling Spatial Projection & CRS in R</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="testimonial">
  <h2>Authors</h2>
    Joseph Stachelek, Leah Wasser, Megan A. Jones
</blockquote>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 10 min
      <br/>
      <strong>Exercises:</strong> 0 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>What to do when vector data don’t line up.</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Know how to identify the <code class="highlighter-rouge">CRS</code> of a spatial dataset.</p>
</li>
	
	<li><p>Be familiar with geographic vs. projected coordinate reference systems.</p>
</li>
	
	<li><p>Be familiar with the <code class="highlighter-rouge">proj4</code> string format which is one format used used to store / reference the <code class="highlighter-rouge">CRS</code> of a spatial object.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<blockquote class="prereq">
  <h2 id="things-youll-need-to-complete-this-tutorial">Things You’ll Need To Complete This Tutorial</h2>
  <p><strong>R Skill Level:</strong> Intermediate - you’ve got the basics of <code class="highlighter-rouge">R</code> down.
You will need the most current version of <code class="highlighter-rouge">R</code> and, preferably, <code class="highlighter-rouge">RStudio</code> loaded
on your computer to complete this tutorial.</p>

  <h3 id="install-r-packages">Install R Packages</h3>

  <ul>
    <li><strong>raster:</strong> <code class="highlighter-rouge">install.packages("raster")</code></li>
    <li>
      <p><strong>sf:</strong> <code class="highlighter-rouge">install.packages("sf")</code></p>
    </li>
    <li><a href="/R/Packages-In-R/">More on Packages in R - Adapted from Software Carpentry.</a></li>
  </ul>

  <h2 id="data-to-download">Data to Download</h2>
  <ul>
    <li><a href="https://ndownloader.figshare.com/files/3708751">Site layout shapefiles</a></li>
  </ul>
</blockquote>

<p>In this tutorial, we will create a base map of our study site using a United States
state and country boundary accessed from the
<a href="https://www.census.gov/geo/maps-data/data/cbf/cbf_state.html" target="_blank"> United States Census Bureau</a>.
We will learn how to map vector data that are in different <code class="highlighter-rouge">CRS</code> and thus
don’t line up on a map.</p>

<h2 id="working-with-spatial-data-from-different-sources">Working With Spatial Data From Different Sources</h2>

<p>To support a project, we often need to gather spatial datasets for from
different sources and/or data that cover different spatial <code class="highlighter-rouge">extents</code>. Spatial
data from different sources and that cover different extents are often in
different Coordinate Reference Systems (CRS).</p>

<p>Some reasons for data being in different CRS include:</p>

<ol>
  <li>The data are stored in a particular CRS convention used by the data
provider which might be a federal agency, or a state planning office.</li>
  <li>The data are stored in a particular CRS that is customized to a region.
For instance, many states prefer to use a <strong>State Plane</strong> projection customized
for that state.</li>
</ol>

<figure>
    <a href="https://media.opennews.org/cache/06/37/0637aa2541b31f526ad44f7cb2db7b6c.jpg">
    <img src="https://media.opennews.org/cache/06/37/0637aa2541b31f526ad44f7cb2db7b6c.jpg" />
    </a>

    <figcaption>Maps of the United States using data in different projections.
    Notice the differences in shape associated with each different projection.
    These differences are a direct result of the calculations used to "flatten"
    the data onto a 2-dimensional map. Often data are stored purposefully in a
    particular projection that optimizes the relative shape and size of
    surrounding geographic boundaries (states, counties, countries, etc).
    Source: opennews.org</figcaption>
</figure>

<p>Check out this short video highlighting how map projections can make continents
seems proportionally larger or smaller than they actually are!</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/KUF_Ckv8HbE" frameborder="0" allowfullscreen=""></iframe>

<p>In this tutorial we will learn how to identify and manage spatial data
in different projections. We will learn how to <code class="highlighter-rouge">reproject</code> the data so that they
are in the same projection to support plotting / mapping. Note that these skills
are also required for any geoprocessing / spatial analysis. Data need to be in
the same CRS to ensure accurate results.</p>

<p>We will use the <code class="highlighter-rouge">sf</code> and <code class="highlighter-rouge">raster</code> packages in this tutorial.</p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># load packages
library(sf)  # for vector work
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Linking to GEOS 3.5.0, GDAL 2.2.2, proj.4 4.8.0
</code></pre></div></div>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>library(raster)   # for raster metadata/attributes
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Loading required package: sp
</code></pre></div></div>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># set working directory to data folder
# setwd("pathToDirHere")
</code></pre></div></div>

<h2 id="import-us-boundaries---census-data">Import US Boundaries - Census Data</h2>

<p>There are many good sources of boundary base layers that we can use to create a
basemap. Some <code class="highlighter-rouge">R</code> packages even have these base layers built in to support quick
and efficient mapping. In this tutorial, we will use boundary layers for the
United States, provided by the
<a href="https://www.census.gov/geo/maps-data/data/cbf/cbf_state.html" target="_blank"> United States Census Bureau.</a></p>

<p>It is useful to have shapefiles to work with because we can add additional
attributes to them if need be - for project specific mapping.</p>

<h2 id="read-us-boundary-file">Read US Boundary File</h2>

<p>We will use the <code class="highlighter-rouge">st_read()</code> function to import the
<code class="highlighter-rouge">/US-Boundary-Layers/US-State-Boundaries-Census-2014</code> layer into <code class="highlighter-rouge">R</code>. This layer
contains the boundaries of all continental states in the U.S. Please note that
these data have been modified and reprojected from the original data downloaded
from the Census website to support the learning goals of this tutorial.</p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Read the .csv file
state_boundary_US &lt;- st_read("data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/US-State-Boundaries-Census-2014.shp")
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Reading layer `US-State-Boundaries-Census-2014' from data source `/home/travis/build/datacarpentry/r-raster-vector-geospatial/_episodes_rmd/data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/US-State-Boundaries-Census-2014.shp' using driver `ESRI Shapefile'
Simple feature collection with 58 features and 10 fields
geometry type:  MULTIPOLYGON
dimension:      XYZ
bbox:           xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
epsg (SRID):    4326
proj4string:    +proj=longlat +datum=WGS84 +no_defs
</code></pre></div></div>

<p>Next, let’s plot the U.S. states data.</p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># view column names
plot(state_boundary_US$geometry,
     main = "Map of Continental US State Boundaries\n US Census Bureau Data")
</code></pre></div></div>

<p><img src="../fig/rmd-09-find-coordinates-1.png" title="plot of chunk find-coordinates" alt="plot of chunk find-coordinates" style="display: block; margin: auto;" /></p>

<h2 id="us-boundary-layer">U.S. Boundary Layer</h2>

<p>We can add a boundary layer of the United States to our map - to make it look
nicer. We will import
<code class="highlighter-rouge">NEON-DS-Site-Layout-Files/US-Boundary-Layers/US-Boundary-Dissolved-States</code>.
If we specify a thicker line width using <code class="highlighter-rouge">lwd = 4</code> for the border layer, it will
make our map pop!</p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Read the .csv file
country_boundary_US &lt;- st_read("data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/US-Boundary-Dissolved-States.shp")
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Reading layer `US-Boundary-Dissolved-States' from data source `/home/travis/build/datacarpentry/r-raster-vector-geospatial/_episodes_rmd/data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/US-Boundary-Dissolved-States.shp' using driver `ESRI Shapefile'
Simple feature collection with 1 feature and 9 fields
geometry type:  MULTIPOLYGON
dimension:      XYZ
bbox:           xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
epsg (SRID):    4326
proj4string:    +proj=longlat +datum=WGS84 +no_defs
</code></pre></div></div>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>plot(state_boundary_US$geometry,
     main = "Map of Continental US State Boundaries\n US Census Bureau Data",
     border = "gray40")

plot(country_boundary_US$geometry,
     lwd = 4,
     border = "gray18",
     add = TRUE)
</code></pre></div></div>

<p><img src="../fig/rmd-09-check-out-coordinates-1.png" title="plot of chunk check-out-coordinates" alt="plot of chunk check-out-coordinates" style="display: block; margin: auto;" /></p>

<p>Next, let’s add the location of a flux tower where our study area is.
As we are adding these layers, take note of the class of each object.</p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Import a point shapefile
point_HARV &lt;- st_read("data/NEON-DS-Site-Layout-Files/HARV/HARVtower_UTM18N.shp")
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Reading layer `HARVtower_UTM18N' from data source `/home/travis/build/datacarpentry/r-raster-vector-geospatial/_episodes_rmd/data/NEON-DS-Site-Layout-Files/HARV/HARVtower_UTM18N.shp' using driver `ESRI Shapefile'
Simple feature collection with 1 feature and 14 fields
geometry type:  POINT
dimension:      XY
bbox:           xmin: 732183.2 ymin: 4713265 xmax: 732183.2 ymax: 4713265
epsg (SRID):    32618
proj4string:    +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs
</code></pre></div></div>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># plot point - looks ok?
plot(point_HARV$geometry,
     pch = 19,
     col = "purple",
     main = "Harvard Fisher Tower Location")
</code></pre></div></div>

<p><img src="../fig/rmd-09-explore-units-1.png" title="plot of chunk explore-units" alt="plot of chunk explore-units" style="display: block; margin: auto;" /></p>

<p>The plot above demonstrates that the tower point location data is readable and
will plot! Let’s next add it as a layer on top of the U.S. states and boundary
layers in our basemap plot.</p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># plot state boundaries
plot(state_boundary_US$geometry,
     main = "Map of Continental US State Boundaries \n with Tower Location",
     border = "gray40")

# add US border outline
plot(country_boundary_US$geometry,
     lwd = 4,
     border = "gray18",
     add = TRUE)

# add point tower location
plot(point_HARV$geometry,
     pch = 19,
     col = "purple",
     add = TRUE)
</code></pre></div></div>

<p><img src="../fig/rmd-09-layer-point-on-states-1.png" title="plot of chunk layer-point-on-states" alt="plot of chunk layer-point-on-states" style="display: block; margin: auto;" /></p>

<p>What do you notice about the resultant plot? Do you see the tower location in
purple in the Massachusetts area? No! What went wrong?</p>

<p>Let’s check out the CRS (<code class="highlighter-rouge">st_crs()</code>) of both datasets to see if we can identify any
issues that might cause the point location to not plot properly on top of our
U.S. boundary layers.</p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># view CRS of our site data
st_crs(point_HARV)
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Coordinate Reference System:
  EPSG: 32618 
  proj4string: "+proj=utm +zone=18 +datum=WGS84 +units=m +no_defs"
</code></pre></div></div>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># view crs of census data
st_crs(state_boundary_US)
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Coordinate Reference System:
  EPSG: 4326 
  proj4string: "+proj=longlat +datum=WGS84 +no_defs"
</code></pre></div></div>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>st_crs(country_boundary_US)
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Coordinate Reference System:
  EPSG: 4326 
  proj4string: "+proj=longlat +datum=WGS84 +no_defs"
</code></pre></div></div>

<p>It looks like our data are in different CRS. We can tell this by looking at
the CRS strings in <code class="highlighter-rouge">proj4</code> format.</p>

<h2 id="understanding-crs-in-proj4-format">Understanding CRS in Proj4 Format</h2>
<p>The CRS for our data are given to us by <code class="highlighter-rouge">R</code> in <code class="highlighter-rouge">proj4</code> format. Let’s break
down the pieces of <code class="highlighter-rouge">proj4</code> string. The string contains all of the individual
CRS elements that <code class="highlighter-rouge">R</code> or another GIS might need. Each element is specified
with a <code class="highlighter-rouge">+</code> sign, similar to how a <code class="highlighter-rouge">.csv</code> file is delimited or broken up by
a <code class="highlighter-rouge">,</code>. After each <code class="highlighter-rouge">+</code> we see the CRS element being defined. For example
projection (<code class="highlighter-rouge">proj=</code>) and datum (<code class="highlighter-rouge">datum=</code>).</p>

<h3 id="utm-proj4-string">UTM Proj4 String</h3>
<p>Our project string for <code class="highlighter-rouge">point_HARV</code> specifies the UTM projection as follows:</p>

<p><code class="highlighter-rouge">+proj=utm +zone=18 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0</code></p>

<ul>
  <li><strong>proj=utm:</strong> the projection is UTM, UTM has several zones.</li>
  <li><strong>zone=18:</strong> the zone is 18</li>
  <li><strong>datum=WGS84:</strong> the datum WGS84 (the datum refers to the  0,0 reference for
the coordinate system used in the projection)</li>
  <li><strong>units=m:</strong> the units for the coordinates are in METERS.</li>
  <li><strong>ellps=WGS84:</strong> the ellipsoid (how the earth’s  roundness is calculated) for
the data is WGS84</li>
</ul>

<p>Note that the <code class="highlighter-rouge">zone</code> is unique to the UTM projection. Not all CRS will have a
zone.</p>

<h3 id="geographic-lat--long-proj4-string">Geographic (lat / long) Proj4 String</h3>

<p>Our project string for <code class="highlighter-rouge">state_boundary_US</code> and <code class="highlighter-rouge">country_boundary_US</code> specifies
the lat/long projection as follows:</p>

<p><code class="highlighter-rouge">+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0</code></p>

<ul>
  <li><strong>proj=longlat:</strong> the data are in a geographic (latitude and longitude)
coordinate system</li>
  <li><strong>datum=WGS84:</strong> the datum WGS84 (the datum refers to the  0,0 reference for
the coordinate system used in the projection)</li>
  <li><strong>ellps=WGS84:</strong> the ellipsoid (how the earth’s roundness is calculated)
is WGS84</li>
</ul>

<p>Note that there are no specified units above. This is because this geographic
coordinate reference system is in latitude and longitude which is most
often recorded in <em>Decimal Degrees</em>.</p>

<blockquote class="callout">
  <h2 id="data-tip">Data Tip</h2>
  <p>the last portion of each <code class="highlighter-rouge">proj4</code> string
is <code class="highlighter-rouge">+towgs84=0,0,0 </code>. This is a conversion factor that is used if a datum
conversion is required. We will not deal with datums in this tutorial series.</p>
</blockquote>

<h2 id="crs-units---view-object-extent">CRS Units - View Object Extent</h2>

<p>Next, let’s view the extent or spatial coverage for the <code class="highlighter-rouge">point_HARV</code> spatial
object compared to the <code class="highlighter-rouge">state_boundary_US</code> object.</p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># extent for HARV in UTM
st_bbox(point_HARV)
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     xmin      ymin      xmax      ymax 
 732183.2 4713265.0  732183.2 4713265.0 
</code></pre></div></div>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># extent for object in geographic
st_bbox(state_boundary_US)
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      xmin       ymin       xmax       ymax 
-124.72584   24.49813  -66.94989   49.38436 
</code></pre></div></div>

<p>Note the difference in the units for each object. The extent for
<code class="highlighter-rouge">state_boundary_US</code> is in latitude and longitude which yields smaller numbers
representing decimal degree units. Our tower location point is in UTM, is
represented in meters.</p>

<hr />

<h2 id="proj4--crs-resources">Proj4 &amp; CRS Resources</h2>

<ul>
  <li><a href="http://proj.maptools.org/faq.html" target="_blank">More information on the proj4 format.</a></li>
  <li><a href="http://spatialreference.org" target="_blank">A fairly comprehensive list of CRS by format.</a></li>
  <li>To view a list of datum conversion factors type: <code class="highlighter-rouge">projInfo(type = "datum")</code>
into the <code class="highlighter-rouge">R</code> console.</li>
</ul>

<hr />

<h2 id="reproject-vector-data">Reproject Vector Data</h2>

<p>Now we know our data are in different CRS. To address this, we have to modify
or <strong>reproject</strong> the data so they are all in the <strong>same</strong> CRS. We can use
<code class="highlighter-rouge">st_transform()</code> function to reproject our data. When we reproject the data, we
specify the CRS that we wish to transform our data to. This CRS contains
the datum, units and other information that <code class="highlighter-rouge">R</code> needs to <strong>reproject</strong> our data.</p>

<p>The <code class="highlighter-rouge">st_transform()</code> function requires two inputs:</p>

<ol>
  <li>the name of the object that you wish to transform</li>
  <li>the CRS that you wish to transform that object too. In this case we can
use the <code class="highlighter-rouge">st_crs()</code> of the <code class="highlighter-rouge">state_boundary_US</code> object as follows:
<code class="highlighter-rouge">st_crs(state_boundary_US)</code></li>
</ol>

<blockquote class="callout">
  <h2 id="data-tip-1">Data Tip</h2>
  <p><code class="highlighter-rouge">st_transform()</code> will only work if your
original spatial object has a CRS assigned to it AND if that CRS is the
correct CRS!</p>
</blockquote>

<p>Next, let’s reproject our point layer into the geographic - latitude and
longitude <code class="highlighter-rouge">WGS84</code> coordinate reference system (CRS).</p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># reproject data
point_HARV_WGS84 &lt;- st_transform(point_HARV,
                                st_crs(state_boundary_US))

# what is the CRS of the new object
st_crs(point_HARV_WGS84)
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Coordinate Reference System:
  EPSG: 4326 
  proj4string: "+proj=longlat +datum=WGS84 +no_defs"
</code></pre></div></div>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># does the extent look like decimal degrees?
st_bbox(point_HARV_WGS84)
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     xmin      ymin      xmax      ymax 
-72.17266  42.53690 -72.17266  42.53690 
</code></pre></div></div>

<p>Once our data are reprojected, we can try to plot again.</p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># plot state boundaries
plot(state_boundary_US$geometry,
     main = "Map of Continental US State Boundaries\n With Fisher Tower Location",
     border = "gray40")

# add US border outline
plot(country_boundary_US$geometry,
     lwd = 4,
     border = "gray18",
     add = TRUE)

# add point tower location
plot(point_HARV_WGS84$geometry,
     pch = 19,
     col = "purple",
     add = TRUE)
</code></pre></div></div>

<p><img src="../fig/rmd-09-plot-again-1.png" title="plot of chunk plot-again" alt="plot of chunk plot-again" style="display: block; margin: auto;" /></p>

<p>Reprojecting our data ensured that things line up on our map! It will also
allow us to perform any required geoprocessing (spatial calculations /
transformations) on our data.</p>

<blockquote class="challenge">
  <h2 id="challenge---reproject-spatial-data">Challenge - Reproject Spatial Data</h2>

  <p>Create a map of the North Eastern United States as follows:</p>

  <ol>
    <li>Import and plot <code class="highlighter-rouge">Boundary-US-State-NEast.shp</code>. Adjust line width as necessary.</li>
    <li><strong>Reproject</strong> the layer into UTM zone 18 north.</li>
    <li>Layer the Fisher Tower point location <code class="highlighter-rouge">point_HARV</code> on top of the above plot.</li>
    <li>Add a <strong>title</strong> to your plot.</li>
    <li>Add a <strong>legend</strong> to your plot that shows both the state boundary (line) and
the Tower location point.</li>
  </ol>

  <blockquote class="solution">
    <h2 id="answers">Answers</h2>

    <div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># import mass boundary layer
# read the .csv file
NE.States.Boundary.US &lt;- st_read("data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/Boundary-US-State-NEast.shp")
# view crs
st_crs(NE.States.Boundary.US)

# create CRS object
UTM_CRS &lt;- st_crs(point_HARV)
UTM_CRS

# reproject line and point data
NE.States.Boundary.US.UTM  &lt;- st_transform(NE.States.Boundary.US,
                                UTM_CRS)
NE.States.Boundary.US.UTM

# plot state boundaries
plot(NE.States.Boundary.US.UTM$geometry,
     main = "Map of Northeastern US\n With Fisher Tower Location - UTM Zone 18N",
     border="gray18",
     lwd = 2)

# add point tower location
plot(point_HARV$geometry,
     pch = 19,
     col = "purple",
     add = TRUE)

# add legend
# to create a custom legend, we need to fake it
legend("bottomright",
       legend = c("State Boundary", "Fisher Tower"),
       lty = c(1, NA),
       pch = c(NA, 19),
       col = c("gray18", "purple"),
       bty = "n")
</code></pre></div>    </div>

    <p><img src="../fig/rmd-09-challenge-code-MASS-Map-1.png" title="plot of chunk challenge-code-MASS-Map" alt="plot of chunk challenge-code-MASS-Map" style="display: block; margin: auto;" /></p>
  </blockquote>
</blockquote>


<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li>
</li>
    
  </ul>
</blockquote>

</article>

<div class="row">
  <div class="col-md-1">
    <h3>
      
      <a href="../08-vector-plot-shapefiles-custom-legend/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
  </div>
  <div class="col-md-1">
    <h3>
      
      <a href="../10-vector-csv-to-shapefile-in-r/"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      
<footer>
  <div class="row">
    <div class="col-md-6" align="left">
      <h4>
	Copyright &copy; 2016–2018
	
	<a href="http://datacarpentry.org">Data Carpentry</a>
	
      </h4>
    </div>
    <div class="col-md-6" align="right">
      <h4>
	
	<a href="/edit/gh-pages/_episodes/09-vector-when-data-dont-line-up-crs.md">Edit on GitHub</a>
	
	/
	<a href="/blob/gh-pages/CONTRIBUTING.md">Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob/gh-pages/CITATION">Cite</a>
	/
	<a href="mailto:lessons@software-carpentry.org">Contact</a>
      </h4>
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
