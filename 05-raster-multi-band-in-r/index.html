<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2018-04-06 21:35:58 +0000">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    
    <link rel="shortcut icon" type="image/x-icon" href="/favicon-dc.ico" />
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>Intro to Geospatial Data with R: Work With Multi-Band Rasters in R</title>
  </head>
  <body>
    <div class="container">
      
<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="http://datacarpentry.org" class="pull-left">
        <img class="navbar-logo" src="../assets/img/dc-icon-black.svg" alt="Data Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../conduct/">Code of Conduct</a></li>

	
        
        <li><a href="../setup/">Setup</a></li>
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../01-raster-structure/">Intro to Raster Data in R</a></li>
            
            <li><a href="../02-raster-plot/">Plot Raster Data in R</a></li>
            
            <li><a href="../03-raster-reproject-in-r/">Reproject Raster Data in R</a></li>
            
            <li><a href="../04-raster-calculations-in-r/">Raster Calculations in R</a></li>
            
            <li><a href="../05-raster-multi-band-in-r/">Work With Multi-Band Rasters in R</a></li>
            
            <li><a href="../06-vector-open-shapefile-in-r/">Open and Plot Shapefiles in R</a></li>
            
            <li><a href="../07-vector-shapefile-attributes-in-r/">Explore and Plot by Shapefile Attributes</a></li>
            
            <li><a href="../08-vector-plot-shapefiles-custom-legend/">Plot Multiple Shapefiles in R</a></li>
            
            <li><a href="../09-vector-when-data-dont-line-up-crs/">Handling Spatial Projection & CRS in R</a></li>
            
            <li><a href="../10-vector-csv-to-shapefile-in-r/">Convert from .csv to a Shapefile in R</a></li>
            
            <li><a href="../11-vector-raster-integration/">Manipulate Raster Data in R</a></li>
            
            <li><a href="../12-time-series-raster/">Raster Time Series Data in R</a></li>
            
            <li><a href="../13-plot-time-series-rasters-in-r/">Plot Raster Time Series Data in R</a></li>
            
            <li><a href="../14-extract-ndvi-from-rasters-in-r/">Derive Values from Raster Time Series</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference/">Reference</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../license/">License</a></li>
	
	<li><a href="/edit/gh-pages/_episodes/05-raster-multi-band-in-r.md">Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>


<div class="row">
  <div class="col-md-1">
    <h3>
      
      <a href="../04-raster-calculations-in-r/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
    <h3 class="maintitle"><a href="../">Intro to Geospatial Data with R</a></h3>
    
  </div>
  <div class="col-md-1">
    <h3>
      
      <a href="../06-vector-open-shapefile-in-r/"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Work With Multi-Band Rasters in R</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="testimonial">
  <h2>Authors</h2>
    Leah A. Wasser, Megan A. Jones, Zack Brym, Kristina Riemer, Jason Williams, Jeff Hollister, Mike Smorul, Joseph Stachelek
</blockquote>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 10 min
      <br/>
      <strong>Exercises:</strong> 0 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Know how to identify a single vs. a multi-band raster file.</p>
</li>
	
	<li><p>Be able to import multi-band rasters into <code class="highlighter-rouge">R</code> using the <code class="highlighter-rouge">raster</code> package.</p>
</li>
	
	<li><p>Be able to plot multi-band color image rasters in <code class="highlighter-rouge">R</code> using <code class="highlighter-rouge">plotRGB()</code>.</p>
</li>
	
	<li><p>Understand what a <code class="highlighter-rouge">NoData</code> value is in a raster.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<blockquote class="prereq">
  <h2 id="things-youll-need-to-complete-this-tutorial">Things You’ll Need To Complete This Tutorial</h2>
  <p><strong>R Skill Level:</strong> Intermediate - you’ve got the basics of <code class="highlighter-rouge">R</code> down.</p>

  <p>You will need the most current version of <code class="highlighter-rouge">R</code> and, preferably, <code class="highlighter-rouge">RStudio</code> loaded
on your computer to complete this tutorial.</p>

  <h3 id="install-r-packages">Install R Packages</h3>

  <ul>
    <li><strong>raster:</strong> <code class="highlighter-rouge">install.packages("raster")</code></li>
    <li>
      <p><strong>rgdal:</strong> <code class="highlighter-rouge">install.packages("rgdal")</code></p>
    </li>
    <li><a href="/R/Packages-In-R/">More on Packages in R - Adapted from Software Carpentry.</a></li>
  </ul>

  <h4 id="data-to-download">Data to Download</h4>

</blockquote>

<p>This tutorial explores how to import and plot a multi-band raster in
R. It also covers how to plot a three-band color image using the <code class="highlighter-rouge">plotRGB()</code>
function in <code class="highlighter-rouge">R</code>.</p>

<h2 id="the-basics-of-imagery---about-spectral-remote-sensing-data">The Basics of Imagery - About Spectral Remote Sensing Data</h2>

<iframe width="560" height="315" src="https://www.youtube.com/embed/3iaFzafWJQE" frameborder="0" allowfullscreen=""></iframe>

<h2 id="about-raster-bands-in-r">About Raster Bands in R</h2>
<p>As discussed in the
<a href="/R/Introduction-to-Raster-Data-In-R">Intro to Raster Data tutorial</a>,
a raster can contain 1 or more bands.</p>

<figure>
    <a href="/images/dc-spatial-raster/single_multi_raster.png">
    <img src="/images/dc-spatial-raster/single_multi_raster.png" />
    </a>
    <figcaption>A raster can contain one or more bands. We can use the
    raster function to import one single band from a single OR multi-band
    raster.  Source: National Ecological Observatory Network (NEON).</figcaption>
</figure>

<p>To work with multi-band rasters in <code class="highlighter-rouge">R</code>, we need to change how we import and plot
our data in several ways.</p>

<ul>
  <li>To import multi band raster data we will use the <code class="highlighter-rouge">stack()</code> function.</li>
  <li>If our multi-band data are imagery that we wish to composite, we can use
<code class="highlighter-rouge">plotRGB()</code> (instead of <code class="highlighter-rouge">plot()</code>) to plot a 3 band raster image.</li>
</ul>

<h2 id="about-multi-band-imagery">About Multi-Band Imagery</h2>
<p>One type of multi-band raster dataset that is familiar to many of us is a color
image. A basic color image consists of three bands: red, green, and blue. Each
band represents light reflected from the red, green or blue portions of the
electromagnetic spectrum. The pixel brightness for each band, when composited
creates the colors that we see in an image.</p>

<figure>
    <a href="/images/dc-spatial-raster/RGBSTack_1.jpg">
    <img src="/images/dc-spatial-raster/RGBSTack_1.jpg" /></a>
    <figcaption>A color image consists of 3 bands - red, green and blue. When
    rendered together in a GIS, or even a tool like Photoshop or any other
    image software, they create a color image.
	Source: National Ecological Observatory Network (NEON).
    </figcaption>
</figure>

<p>We can plot each band of a multi-band image individually.</p>

<blockquote class="callout">
  <h2 id="data-tip">Data Tip</h2>
  <p>In many GIS applications, a single band
would render as a single image in grayscale. We will therefore use a grayscale
palette to render individual bands.</p>
</blockquote>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Loading required package: sp
</code></pre></div></div>

<p><img src="../fig/rmd-05-demonstrate-RGB-Image-1.png" title="plot of chunk demonstrate-RGB-Image" alt="plot of chunk demonstrate-RGB-Image" style="display: block; margin: auto;" /></p>

<p>Or we can composite all three bands together to make a color image.</p>

<p><img src="../fig/rmd-05-plot-RGB-now-1.png" title="plot of chunk plot-RGB-now" alt="plot of chunk plot-RGB-now" style="display: block; margin: auto;" /></p>

<p>In a multi-band dataset, the rasters will always have the same <em>extent</em>,
<em>CRS</em> and <em>resolution</em>.</p>

<h2 id="other-types-of-multi-band-raster-data">Other Types of Multi-band Raster Data</h2>

<p>Multi-band raster data might also contain:</p>

<ol>
  <li><strong>Time series:</strong> the same variable, over the same area, over time. Check out
<a href="/R/Raster-Times-Series-Data-In-R/">Raster Time Series Data in R </a>
to learn more about time series stacks.</li>
  <li><strong>Multi or hyperspectral imagery:</strong> image rasters that have 4 or more
(multi-spectral) or more than 10-15 (hyperspectral) bands. Check out the NEON
Data Skills
<a href="/HDF5/Imaging-Spectroscopy-HDF5-In-R/">Imaging Spectroscopy HDF5 in R </a>
tutorial for more about working with hyperspectral data cubes.</li>
</ol>

<h2 id="getting-started-with-multi-band-data-in-r">Getting Started with Multi-Band Data in R</h2>
<p>To work with multi-band raster data we will use the <code class="highlighter-rouge">raster</code> and <code class="highlighter-rouge">rgdal</code>
packages.</p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># work with raster data
library(raster)
# export GeoTIFFs and other core GIS functions
library(rgdal)
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rgdal: version: 1.2-18, (SVN revision 718)
 Geospatial Data Abstraction Library extensions to R successfully loaded
 Loaded GDAL runtime: GDAL 2.2.2, released 2017/09/15
 Path to GDAL shared files: /usr/share/gdal/2.2
 GDAL binary built with GEOS: TRUE 
 Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
 Path to PROJ.4 shared files: (autodetected)
 Linking to sp version: 1.2-7 
</code></pre></div></div>

<p>In this tutorial, the multi-band data that we are working with is imagery
collected using the
<a href="http://www.neonscience.org/science-design/collection-methods/airborne-remote-sensing" target="_blank">NEON Airborne Observation Platform</a>
high resolution camera over the
<a href="http://www.neonscience.org/science-design/field-sites/harvard-forest" target="_blank">NEON Harvard Forest field site</a>.
Each RGB image is a 3-band raster. The same steps would apply to
working with a multi-spectral image with 4 or more bands - like Landsat imagery.</p>

<p>If we read a <code class="highlighter-rouge">rasterStack</code> into <code class="highlighter-rouge">R</code> using the <code class="highlighter-rouge">raster()</code> function, it only reads
in the first band. We can plot this band using the plot function.</p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Read in multi-band raster with raster function.
# Default is the first band only.
RGB_band1_HARV &lt;-
  raster("data/NEON-DS-Airborne-Remote-Sensing/HARV/RGB_Imagery/HARV_RGB_Ortho.tif")

# create a grayscale color palette to use for the image.
grayscale_colors &lt;- gray.colors(100,            # number of different color levels
                                start = 0.0,    # how black (0) to go
                                end = 1.0,      # how white (1) to go
                                gamma = 2.2,    # correction between how a digital
                                # camera sees the world and how human eyes see it
                                alpha = NULL)   #Null = colors are not transparent

# Plot band 1
plot(RGB_band1_HARV,
     col = grayscale_colors,
     axes = FALSE,
     main = "RGB Imagery - Band 1-Red\nNEON Harvard Forest Field Site")
</code></pre></div></div>

<p><img src="../fig/rmd-05-read-single-band-1.png" title="plot of chunk read-single-band" alt="plot of chunk read-single-band" style="display: block; margin: auto;" /></p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># view attributes: Check out dimension, CRS, resolution, values attributes, and
# band.
RGB_band1_HARV
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class       : RasterLayer 
band        : 1  (of  3  bands)
dimensions  : 2317, 3073, 7120141  (nrow, ncol, ncell)
resolution  : 0.25, 0.25  (x, y)
extent      : 731998.5, 732766.8, 4712956, 4713536  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
data source : /home/travis/build/datacarpentry/r-raster-vector-geospatial/_episodes_rmd/data/NEON-DS-Airborne-Remote-Sensing/HARV/RGB_Imagery/HARV_RGB_Ortho.tif 
names       : HARV_RGB_Ortho 
values      : 0, 255  (min, max)
</code></pre></div></div>

<p>Notice that when we look at the attributes of RGB_Band1, we see :</p>

<p><code class="highlighter-rouge">band: 1  (of  3  bands)</code></p>

<p>This is <code class="highlighter-rouge">R</code> telling us that this particular raster object has more bands (3)
associated with it.</p>

<blockquote class="callout">
  <h2 id="data-tip-1">Data Tip</h2>
  <p>The number of bands associated with a
raster object can also be determined using the <code class="highlighter-rouge">nbands</code> slot. Syntax is
<code class="highlighter-rouge">ObjectName@file@nbands</code>, or specifically for our file: <code class="highlighter-rouge">RGB_band1@file@nbands</code>.</p>
</blockquote>

<h3 id="image-raster-data-values">Image Raster Data Values</h3>
<p>Let’s next examine the raster’s min and max values. What is the value range?</p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># view min value
minValue(RGB_band1_HARV)
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 0
</code></pre></div></div>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># view max value
maxValue(RGB_band1_HARV)
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 255
</code></pre></div></div>

<p>This raster contains values between 0 and 255. These values
represent degrees of brightness associated with the image band. In
the case of a RGB image (red, green and blue), band 1 is the red band. When
we plot the red band, larger numbers (towards 255) represent pixels with more
red in them (a strong red reflection). Smaller numbers (towards 0) represent
pixels with less red in them (less red was reflected). To
plot an RGB image, we mix red + green + blue values into one single color to
create a full color image - similar to the color image a digital camera creates.</p>

<h3 id="import-a-specific-band">Import A Specific Band</h3>
<p>We can use the <code class="highlighter-rouge">raster()</code> function to import specific bands in our raster object
by specifying which band we want with <code class="highlighter-rouge">band=N</code> (N represents the band number we
want to work with). To import the green band, we would use <code class="highlighter-rouge">band=2</code>.</p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Can specify which band we want to read in
RGB_band2_HARV &lt;-
  raster("data/NEON-DS-Airborne-Remote-Sensing/HARV/RGB_Imagery/HARV_RGB_Ortho.tif",
           band = 2)

# plot band 2
plot(RGB_band2_HARV,
     col = grayscale_colors, # we already created this palette &amp; can use it again
     axes = FALSE,
     main = "RGB Imagery - Band 2- Green\nNEON Harvard Forest Field Site")
</code></pre></div></div>

<p><img src="../fig/rmd-05-read-specific-band-1.png" title="plot of chunk read-specific-band" alt="plot of chunk read-specific-band" style="display: block; margin: auto;" /></p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># view attributes of band 2
RGB_band2_HARV
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class       : RasterLayer 
band        : 2  (of  3  bands)
dimensions  : 2317, 3073, 7120141  (nrow, ncol, ncell)
resolution  : 0.25, 0.25  (x, y)
extent      : 731998.5, 732766.8, 4712956, 4713536  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
data source : /home/travis/build/datacarpentry/r-raster-vector-geospatial/_episodes_rmd/data/NEON-DS-Airborne-Remote-Sensing/HARV/RGB_Imagery/HARV_RGB_Ortho.tif 
names       : HARV_RGB_Ortho 
values      : 0, 255  (min, max)
</code></pre></div></div>

<p>Notice that band 2 is the second of 3 bands <code class="highlighter-rouge">band: 2  (of  3  bands)</code>.</p>

<blockquote class="challenge">
  <h2 id="challenge-making-sense-of-single-band-images">Challenge: Making Sense of Single Band Images</h2>

  <p>Compare the plots of band 1 (red) and band 2 (green). Is the forested area darker or lighter in band 2 (the green band) compared to band 1 (the red band)? &gt;</p>
  <blockquote class="solution">
    <h2 id="answers">Answers</h2>

    <div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># We'd expect a *brighter* value for the forest in band 2 (green) than in
# band 1 (red) because the leaves on trees of most often appear "green" -
# healthy leaves reflect MORE green light compared to red light
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="raster-stacks-in-r">Raster Stacks in R</h2>
<p>Next, we will work with all three image bands (red, green and blue) as an <code class="highlighter-rouge">R</code>
<code class="highlighter-rouge">RasterStack</code> object. We will then plot a 3-band composite, or full color,
image.</p>

<p>To bring in all bands of a multi-band raster, we use the<code class="highlighter-rouge">stack()</code> function.</p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Use stack function to read in all bands
RGB_stack_HARV &lt;-
  stack("data/NEON-DS-Airborne-Remote-Sensing/HARV/RGB_Imagery/HARV_RGB_Ortho.tif")

# view attributes of stack object
RGB_stack_HARV
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class       : RasterStack 
dimensions  : 2317, 3073, 7120141, 3  (nrow, ncol, ncell, nlayers)
resolution  : 0.25, 0.25  (x, y)
extent      : 731998.5, 732766.8, 4712956, 4713536  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
names       : HARV_RGB_Ortho.1, HARV_RGB_Ortho.2, HARV_RGB_Ortho.3 
min values  :                0,                0,                0 
max values  :              255,              255,              255 
</code></pre></div></div>

<p>We can view the attributes of each band the stack using <code class="highlighter-rouge">RGB_stack_HARV@layers</code>.
Or we if we have hundreds of bands, we can specify which band we’d like to view
attributes for using an index value: <code class="highlighter-rouge">RGB_stack_HARV[[1]]</code>. We can also use the
 <code class="highlighter-rouge">plot()</code> and <code class="highlighter-rouge">hist()</code> functions on the <code class="highlighter-rouge">RasterStack</code> to plot and view the
 distribution of raster band values.</p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># view raster attributes
RGB_stack_HARV@layers
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[[1]]
class       : RasterLayer 
band        : 1  (of  3  bands)
dimensions  : 2317, 3073, 7120141  (nrow, ncol, ncell)
resolution  : 0.25, 0.25  (x, y)
extent      : 731998.5, 732766.8, 4712956, 4713536  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
data source : /home/travis/build/datacarpentry/r-raster-vector-geospatial/_episodes_rmd/data/NEON-DS-Airborne-Remote-Sensing/HARV/RGB_Imagery/HARV_RGB_Ortho.tif 
names       : HARV_RGB_Ortho.1 
values      : 0, 255  (min, max)


[[2]]
class       : RasterLayer 
band        : 2  (of  3  bands)
dimensions  : 2317, 3073, 7120141  (nrow, ncol, ncell)
resolution  : 0.25, 0.25  (x, y)
extent      : 731998.5, 732766.8, 4712956, 4713536  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
data source : /home/travis/build/datacarpentry/r-raster-vector-geospatial/_episodes_rmd/data/NEON-DS-Airborne-Remote-Sensing/HARV/RGB_Imagery/HARV_RGB_Ortho.tif 
names       : HARV_RGB_Ortho.2 
values      : 0, 255  (min, max)


[[3]]
class       : RasterLayer 
band        : 3  (of  3  bands)
dimensions  : 2317, 3073, 7120141  (nrow, ncol, ncell)
resolution  : 0.25, 0.25  (x, y)
extent      : 731998.5, 732766.8, 4712956, 4713536  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
data source : /home/travis/build/datacarpentry/r-raster-vector-geospatial/_episodes_rmd/data/NEON-DS-Airborne-Remote-Sensing/HARV/RGB_Imagery/HARV_RGB_Ortho.tif 
names       : HARV_RGB_Ortho.3 
values      : 0, 255  (min, max)
</code></pre></div></div>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># view attributes for one band
RGB_stack_HARV[[1]]
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class       : RasterLayer 
band        : 1  (of  3  bands)
dimensions  : 2317, 3073, 7120141  (nrow, ncol, ncell)
resolution  : 0.25, 0.25  (x, y)
extent      : 731998.5, 732766.8, 4712956, 4713536  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
data source : /home/travis/build/datacarpentry/r-raster-vector-geospatial/_episodes_rmd/data/NEON-DS-Airborne-Remote-Sensing/HARV/RGB_Imagery/HARV_RGB_Ortho.tif 
names       : HARV_RGB_Ortho.1 
values      : 0, 255  (min, max)
</code></pre></div></div>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># view histogram of all 3 bands
hist(RGB_stack_HARV,
     maxpixels = ncell(RGB_stack_HARV))

# plot all three bands separately
plot(RGB_stack_HARV,
     col = grayscale_colors)
</code></pre></div></div>

<p><img src="../fig/rmd-05-plot-raster-layers-1.png" title="plot of chunk plot-raster-layers" alt="plot of chunk plot-raster-layers" style="display: block; margin: auto;" /><img src="../fig/rmd-05-plot-raster-layers-2.png" title="plot of chunk plot-raster-layers" alt="plot of chunk plot-raster-layers" style="display: block; margin: auto;" /></p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># revert to a single plot layout
par(mfrow = c(1, 1)) 

# plot band 2
plot(RGB_stack_HARV[[2]],
     main = "Band 2\n NEON Harvard Forest Field Site",
     col = grayscale_colors)
</code></pre></div></div>

<p><img src="../fig/rmd-05-plot-raster-layers-3.png" title="plot of chunk plot-raster-layers" alt="plot of chunk plot-raster-layers" style="display: block; margin: auto;" /></p>

<h3 id="create-a-three-band-image">Create A Three Band Image</h3>
<p>To render a final 3 band, color image in <code class="highlighter-rouge">R</code>, we use <code class="highlighter-rouge">plotRGB()</code>.</p>

<p>This function allows us to:</p>

<ol>
  <li>Identify what bands we want to render in the red, green and blue regions. The
<code class="highlighter-rouge">plotRGB()</code> function defaults to a 1=red, 2=green, and 3=blue band order. However,
you can define what bands you’d like to plot manually. Manual definition of
bands is useful if you have, for example a near-infrared band and want to create
a color infrared image.</li>
  <li>Adjust the <code class="highlighter-rouge">stretch</code> of the image to increase or decrease contrast.</li>
</ol>

<p>Let’s plot our 3-band image.</p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Create an RGB image from the raster stack
plotRGB(RGB_stack_HARV,
        r = 1, g = 2, b = 3)
</code></pre></div></div>

<p><img src="../fig/rmd-05-plot-rgb-image-1.png" title="plot of chunk plot-rgb-image" alt="plot of chunk plot-rgb-image" style="display: block; margin: auto;" /></p>

<p>The image above looks pretty good. We can explore whether applying a stretch to
the image might improve clarity and contrast using  <code class="highlighter-rouge">stretch="lin"</code> or
<code class="highlighter-rouge">stretch="hist"</code>.</p>

<figure>
    <a href="/images/dc-spatial-raster/imageStretch_dark.jpg">
    <img src="/images/dc-spatial-raster/imageStretch_dark.jpg" />
    </a>
    <figcaption>When the range of pixel brightness values is closer to 0, a
    darker image is rendered by default. We can stretch the values to extend to
    the full 0-255 range of potential values to increase the visual contrast of
    the image.
    </figcaption>
</figure>

<figure>
    <a href="/images/dc-spatial-raster/imageStretch_light.jpg">
    <img src="/images/dc-spatial-raster/imageStretch_light.jpg" />
    </a>
    <figcaption>When the range of pixel brightness values is closer to 255, a
    lighter image is rendered by default. We can stretch the values to extend to
    the full 0-255 range of potential values to increase the visual contrast of
    the image.
    </figcaption>
</figure>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># what does stretch do?
plotRGB(RGB_stack_HARV,
        r = 1, g = 2, b = 3,
        scale = 800,
        stretch = "lin")
</code></pre></div></div>

<p><img src="../fig/rmd-05-image-stretch-1.png" title="plot of chunk image-stretch" alt="plot of chunk image-stretch" style="display: block; margin: auto;" /></p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>plotRGB(RGB_stack_HARV,
        r = 1, g = 2, b = 3,
        scale = 800,
        stretch = "hist")
</code></pre></div></div>

<p><img src="../fig/rmd-05-image-stretch-2.png" title="plot of chunk image-stretch" alt="plot of chunk image-stretch" style="display: block; margin: auto;" /></p>

<p>In this case, the stretch doesn’t enhance the contrast our image significantly
given the distribution of reflectance (or brightness) values is distributed well
between 0 and 255.</p>

<blockquote class="challenge">
  <h2 id="challenge---nodata-values">Challenge - NoData Values</h2>

  <p>Let’s explore what happens with NoData values when using <code class="highlighter-rouge">RasterStack</code> and
<code class="highlighter-rouge">plotRGB</code>. We will use the <code class="highlighter-rouge">HARV_Ortho_wNA.tif</code> GeoTIFF in the
<code class="highlighter-rouge">NEON-DS-Airborne-Remote-Sensing/HARVRGB_Imagery/</code> directory.</p>

  <ol>
    <li>View the files attributes. Are there <code class="highlighter-rouge">NoData</code> values assigned for this file?</li>
    <li>If so, what is the <code class="highlighter-rouge">NoData</code> Value?</li>
    <li>How many bands does it have?</li>
    <li>Open the multi-band raster file in <code class="highlighter-rouge">R</code>.</li>
    <li>Plot the object as a true color image.</li>
    <li>What happened to the black edges in the data?</li>
    <li>What does this tell us about the difference in the data structure between
<code class="highlighter-rouge">HARV_Ortho_wNA.tif</code> and <code class="highlighter-rouge">HARV_RGB_Ortho.tif</code> (<code class="highlighter-rouge">R</code> object <code class="highlighter-rouge">RGB_stack</code>). How can
you check?</li>
  </ol>

  <p>Answer the questions above using the functions we have covered so far in this
tutorial.</p>

  <blockquote class="solution">
    <h2 id="answers-1">Answers</h2>

    <div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 1.
# view attributes
GDALinfo("data/NEON-DS-Airborne-Remote-Sensing/HARV/RGB_Imagery/HARV_Ortho_wNA.tif")

# 2 Yes it has NoData values as they are assigned as -9999
# 3 3 bands

# 4
# reading in file
HARV_NA &lt;-
  stack("data/NEON-DS-Airborne-Remote-Sensing/HARV/RGB_Imagery/HARV_Ortho_wNA.tif")

# 5
plotRGB(HARV_NA,
        r = 1, g = 2, b = 3)
</code></pre></div>    </div>

    <p><img src="../fig/rmd-05-challenge-code-NoData-1.png" title="plot of chunk challenge-code-NoData" alt="plot of chunk challenge-code-NoData" style="display: block; margin: auto;" /></p>

    <div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#6 The black edges are not plotted.
#7 Both have NoData values, however, in RGB_stack the NoData value is not
# defined in the tiff tags, thus R renders them as black as the reflectance
# values are 0. The black edges in the other file are defined as -9999 and R
# renders them as NA.
GDALinfo("data/NEON-DS-Airborne-Remote-Sensing/HARV/RGB_Imagery/HARV_RGB_Ortho.tif")
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="callout">
  <h2 id="data-tip-2">Data Tip</h2>
  <p>We can create a RasterStack from
several, individual single-band GeoTIFFs too. Check out:
<a href="/R/Raster-Times-Series-Data-In-R/">Raster Time Series Data in R</a>
for a tutorial on how to do this.</p>
</blockquote>

<h2 id="rasterstack-vs-rasterbrick-in-r">RasterStack vs RasterBrick in R</h2>

<p>The <code class="highlighter-rouge">R</code> <code class="highlighter-rouge">RasterStack</code> and <code class="highlighter-rouge">RasterBrick</code> object types can both store multiple bands.
However, how they store each band is different. The bands in a <code class="highlighter-rouge">RasterStack</code> are
stored as links to raster data that is located somewhere on our computer. A
<code class="highlighter-rouge">RasterBrick</code> contains all of the objects stored within the actual <code class="highlighter-rouge">R</code> object.
In most cases, we can work with a <code class="highlighter-rouge">RasterBrick</code> in the same way we might work
with a <code class="highlighter-rouge">RasterStack</code>. However a <code class="highlighter-rouge">RasterBrick</code> is often more efficient and faster
to process - which is important when working with larger files.</p>

<ul>
  <li><a href="http://www.inside-r.org/packages/cran/raster/docs/brick" target="_blank">
More on Raster Bricks</a></li>
</ul>

<p>We can turn a <code class="highlighter-rouge">RasterStack</code> into a <code class="highlighter-rouge">RasterBrick</code> in <code class="highlighter-rouge">R</code> by using
<code class="highlighter-rouge">brick(StackName)</code>. Let’s use the <code class="highlighter-rouge">object.size()</code> function to compare <code class="highlighter-rouge">stack</code>
and <code class="highlighter-rouge">brick</code> <code class="highlighter-rouge">R</code> objects.</p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># view size of the RGB_stack object that contains our 3 band image
object.size(RGB_stack_HARV)
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>41784 bytes
</code></pre></div></div>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># convert stack to a brick
RGB_brick_HARV &lt;- brick(RGB_stack_HARV)

# view size of the brick
object.size(RGB_brick_HARV)
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>170896376 bytes
</code></pre></div></div>

<p>Notice that in the <code class="highlighter-rouge">RasterBrick</code>, all of the bands are stored within the actual
object. Thus, the <code class="highlighter-rouge">RasterBrick</code> object size is much larger than the
<code class="highlighter-rouge">RasterStack</code> object.</p>

<p>You use <code class="highlighter-rouge">plotRGB</code> to block a <code class="highlighter-rouge">RasterBrick</code> too.</p>

<div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># plot brick
plotRGB(RGB_brick_HARV)
</code></pre></div></div>

<p><img src="../fig/rmd-05-plot-brick-1.png" title="plot of chunk plot-brick" alt="plot of chunk plot-brick" style="display: block; margin: auto;" /></p>

<blockquote class="challenge">
  <h2 id="challenge-what-methods-can-be-used-on-an-r-object">Challenge: What Methods Can Be Used on an R Object?</h2>

  <p>We can view various methods available to call on an <code class="highlighter-rouge">R</code> object with
<code class="highlighter-rouge">methods(class=class(objectNameHere))</code>. Use this to figure out:</p>

  <ol>
    <li>What methods can be used to call on the <code class="highlighter-rouge">RGB_stack_HARV</code> object?</li>
    <li>What methods are available for a single band within <code class="highlighter-rouge">RGB_stack_HARV</code>?</li>
    <li>Why do you think there is a difference?</li>
  </ol>

  <blockquote class="solution">
    <h2 id="answers-2">Answers</h2>

    <div class="r highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 1
# methods for calling a stack
methods(class=class(RGB_stack_HARV))
# 143 methods!

# 2
# methods for calling a band (1) with a stack
methods(class=class(RGB_stack_HARV[1]))

#3 There are far more thing one could or wants to ask of a full stack than of
# a single band.
</code></pre></div>    </div>
  </blockquote>
</blockquote>


<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>A single raster file can contain multiple bands or layers.</p>
</li>
    
  </ul>
</blockquote>

</article>

<div class="row">
  <div class="col-md-1">
    <h3>
      
      <a href="../04-raster-calculations-in-r/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
  </div>
  <div class="col-md-1">
    <h3>
      
      <a href="../06-vector-open-shapefile-in-r/"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      
<footer>
  <div class="row">
    <div class="col-md-6" align="left">
      <h4>
	Copyright &copy; 2016–2018
	
	<a href="http://datacarpentry.org">Data Carpentry</a>
	
      </h4>
    </div>
    <div class="col-md-6" align="right">
      <h4>
	
	<a href="/edit/gh-pages/_episodes/05-raster-multi-band-in-r.md">Edit on GitHub</a>
	
	/
	<a href="/blob/gh-pages/CONTRIBUTING.md">Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob/gh-pages/CITATION">Cite</a>
	/
	<a href="mailto:lessons@software-carpentry.org">Contact</a>
      </h4>
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
