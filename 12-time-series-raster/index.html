<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2018-04-06 21:35:58 +0000">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    
    <link rel="shortcut icon" type="image/x-icon" href="/favicon-dc.ico" />
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>Intro to Geospatial Data with R: Raster Time Series Data in R</title>
  </head>
  <body>
    <div class="container">
      
<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="http://datacarpentry.org" class="pull-left">
        <img class="navbar-logo" src="../assets/img/dc-icon-black.svg" alt="Data Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../conduct/">Code of Conduct</a></li>

	
        
        <li><a href="../setup/">Setup</a></li>
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../01-raster-structure/">Intro to Raster Data in R</a></li>
            
            <li><a href="../02-raster-plot/">Plot Raster Data in R</a></li>
            
            <li><a href="../03-raster-reproject-in-r/">Reproject Raster Data in R</a></li>
            
            <li><a href="../04-raster-calculations-in-r/">Raster Calculations in R</a></li>
            
            <li><a href="../05-raster-multi-band-in-r/">Work With Multi-Band Rasters in R</a></li>
            
            <li><a href="../06-vector-open-shapefile-in-r/">Open and Plot Shapefiles in R</a></li>
            
            <li><a href="../07-vector-shapefile-attributes-in-r/">Explore and Plot by Shapefile Attributes</a></li>
            
            <li><a href="../08-vector-plot-shapefiles-custom-legend/">Plot Multiple Shapefiles in R</a></li>
            
            <li><a href="../09-vector-when-data-dont-line-up-crs/">Handling Spatial Projection & CRS in R</a></li>
            
            <li><a href="../10-vector-csv-to-shapefile-in-r/">Convert from .csv to a Shapefile in R</a></li>
            
            <li><a href="../11-vector-raster-integration/">Manipulate Raster Data in R</a></li>
            
            <li><a href="../12-time-series-raster/">Raster Time Series Data in R</a></li>
            
            <li><a href="../13-plot-time-series-rasters-in-r/">Plot Raster Time Series Data in R</a></li>
            
            <li><a href="../14-extract-ndvi-from-rasters-in-r/">Derive Values from Raster Time Series</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference/">Reference</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../license/">License</a></li>
	
	<li><a href="/edit/gh-pages/_episodes/12-time-series-raster.md">Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>


<div class="row">
  <div class="col-md-1">
    <h3>
      
      <a href="../11-vector-raster-integration/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
    <h3 class="maintitle"><a href="../">Intro to Geospatial Data with R</a></h3>
    
  </div>
  <div class="col-md-1">
    <h3>
      
      <a href="../13-plot-time-series-rasters-in-r/"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Raster Time Series Data in R</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="testimonial">
  <h2>Authors</h2>
    Leah A. Wasser, Megan A. Jones, Zack Brym, Kristina Riemer, Jason Williams, Jeff Hollister, Mike Smorul, Joseph Stachelek
</blockquote>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 10 min
      <br/>
      <strong>Exercises:</strong> 0 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Understand the format of a time series raster dataset.</p>
</li>
	
	<li><p>Know how to work with time series rasters.</p>
</li>
	
	<li><p>Be able to efficiently import a set of rasters stored in a single directory.</p>
</li>
	
	<li><p>Be able to plot and explore time series raster data using the <code class="highlighter-rouge">plot()</code> function in <code class="highlighter-rouge">R</code>.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<blockquote class="prereq">
  <h2 id="things-youll-need-to-complete-this-tutorial">Things You’ll Need To Complete This Tutorial</h2>
  <p><strong>R Skill Level:</strong> Intermediate - you’ve got the basics of <code class="highlighter-rouge">R</code> down.
You will need the most current version of <code class="highlighter-rouge">R</code> and, preferably, <code class="highlighter-rouge">RStudio</code> loaded
on your computer to complete this tutorial.</p>

  <h3 id="install-r-packages">Install R Packages</h3>

  <ul>
    <li><strong>raster:</strong> <code class="highlighter-rouge">install.packages("raster")</code></li>
    <li>
      <p><strong>rgdal:</strong> <code class="highlighter-rouge">install.packages("rgdal")</code></p>
    </li>
    <li><a href="/R/Packages-In-R/">More on Packages in R - Adapted from Software Carpentry.</a></li>
  </ul>

  <h4 id="data-to-download">Data to Download</h4>

  <h3 id="additional-resources">Additional Resources</h3>
  <ul>
    <li><a href="http://cran.r-project.org/web/packages/raster/raster.pdf" target="_blank">
Read more about the <code class="highlighter-rouge">raster</code> package in <code class="highlighter-rouge">R</code>.</a></li>
  </ul>
</blockquote>

<p>This tutorial covers how to work with and plot a raster time series, using an
<code class="highlighter-rouge">R</code> <code class="highlighter-rouge">RasterStack</code> object. It also covers practical assessment of data quality in
remote sensing derived imagery.</p>

<h2 id="about-raster-time-series-data">About Raster Time Series Data</h2>

<p>A raster data file can contain one single band or many bands. If the raster data
contains imagery data, each band may represent reflectance for a different
wavelength (color or type of light) or set of wavelengths - for
example red, green and blue. A multi-band raster may two or more bands or layers
of data collected at different times for the same <strong>extent</strong> (region) and of the
same <strong>resolution</strong>.</p>

<figure>
    <a href="/images/dc-spatial-raster/GreennessOverTime.jpg">
    <img src="/images/dc-spatial-raster/GreennessOverTime.jpg" /></a>
    <figcaption>A multi-band raster dataset can contain time series data.
    Source: National Ecological Observatory Network (NEON).
    </figcaption>
</figure>

<p>The raster data that we will use in this tutorial are located in the
(<code class="highlighter-rouge">NEON-DS-Landsat-NDVI\HARV\2011\NDVI</code>) directory and cover part of the
<a href="http://www.neonscience.org/science-design/field-sites/harvard-forest" target="_blank">NEON Harvard Forest field site</a>.</p>

<p>In this tutorial, we will:</p>

<ol>
  <li>Import NDVI data in <code class="highlighter-rouge">GeoTIFF</code> format.</li>
  <li>Import, explore and plot NDVI data derived for several dates throughout the
year.</li>
  <li>View the RGB imagery used to derived the NDVI time series to better
understand unusual / outlier values.</li>
</ol>

<h2 id="ndvi-data">NDVI Data</h2>
<p>The Normalized Difference Vegetation Index or NDVI is a quantitative index of
greenness ranging from 0-1 where 0 represents minimal or no greenness and 1
represents maximum greenness.</p>

<p>NDVI is often used for a quantative proxy measure of vegetation health, cover
and phenology (life cycle stage) over large areas. Our NDVI data is a Landsat
derived single band product saved as a GeoTIFF for different times of the year.</p>

<figure>
 <a href="http://earthobservatory.nasa.gov/Features/MeasuringVegetation/Images/ndvi_example.jpg">
 <img src="http://earthobservatory.nasa.gov/Features/MeasuringVegetation/Images/ndvi_example.jpg" /></a>
    <figcaption>NDVI is calculated from the visible and near-infrared light
    reflected by vegetation. Healthy vegetation (left) absorbs most of the
    visible light that hits it, and reflects a large portion of
    near-infrared light. Unhealthy or sparse vegetation (right) reflects more
    visible light and less near-infrared light. Image &amp; Caption Source: NASA
    </figcaption>
</figure>

<ul>
  <li><a href="http://earthobservatory.nasa.gov/Features/MeasuringVegetation/measuring_vegetation_2.php" target="_blank">
More on NDVI from NASA</a></li>
</ul>

<h2 id="rgb-data">RGB Data</h2>
<p>While the NDVI data is a single band product, the RGB images that contain the
red band used to derive NDVI, contain 3 (of the 7) 30m resolution bands
available from Landsat data. The RGB directory contains RGB images for each time
period that NDVI is available.</p>

<figure>
    <a href="/images/dc-spatial-raster/RGBSTack_1.jpg">
    <img src="/images/dc-spatial-raster/RGBSTack_1.jpg" /></a>
    <figcaption>A "true" color image consists of 3 bands - red, green and blue.
    When composited or rendered together in a GIS, or even a image-editor like
    Photoshop the bands create a color image.
	Source: National Ecological Observatory Network (NEON).
    </figcaption>
</figure>

<h3 id="getting-started">Getting Started</h3>
<p>In this tutorial, we will use the <code class="highlighter-rouge">raster</code> and <code class="highlighter-rouge">rgdal</code> libraries.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># load packages</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Loading required package: sp
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">rgdal</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rgdal: version: 1.2-8, (SVN revision 663)
 Geospatial Data Abstraction Library extensions to R successfully loaded
 Loaded GDAL runtime: GDAL 2.2.1, released 2017/06/23
 Path to GDAL shared files: /usr/share/gdal/2.2
 Loaded PROJ.4 runtime: Rel. 4.9.2, 08 September 2015, [PJ_VERSION: 492]
 Path to PROJ.4 shared files: (autodetected)
 Linking to sp version: 1.2-5 
</code></pre></div></div>

<p>To begin, we will create a list of raster files using the <code class="highlighter-rouge">list.files()</code>
function in <code class="highlighter-rouge">R</code>. This list will be used to generate a <code class="highlighter-rouge">RasterStack</code>. We will
only add files to our list with a <code class="highlighter-rouge">.tif</code> extension using the syntax
<code class="highlighter-rouge">pattern=".tif$"</code>.</p>

<p>If we specify <code class="highlighter-rouge">full.names=TRUE</code>, the full path for each file will be added to
the list.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create list of NDVI file paths</span><span class="w">
</span><span class="c1"># assign path to object = cleaner code</span><span class="w">
</span><span class="n">NDVI_HARV_path</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI"</span><span class="w">
</span><span class="n">all_NDVI_HARV</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">list.files</span><span class="p">(</span><span class="n">NDVI_HARV_path</span><span class="p">,</span><span class="w">
                            </span><span class="n">full.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
                            </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">".tif$"</span><span class="p">)</span><span class="w">

</span><span class="c1"># view list - note the full path, relative to our working directory, is included</span><span class="w">
</span><span class="n">all_NDVI_HARV</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/005_HARV_ndvi_crop.tif"
 [2] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/037_HARV_ndvi_crop.tif"
 [3] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/085_HARV_ndvi_crop.tif"
 [4] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/133_HARV_ndvi_crop.tif"
 [5] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/181_HARV_ndvi_crop.tif"
 [6] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/197_HARV_ndvi_crop.tif"
 [7] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/213_HARV_ndvi_crop.tif"
 [8] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/229_HARV_ndvi_crop.tif"
 [9] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/245_HARV_ndvi_crop.tif"
[10] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/261_HARV_ndvi_crop.tif"
[11] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/277_HARV_ndvi_crop.tif"
[12] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/293_HARV_ndvi_crop.tif"
[13] "data/NEON-DS-Landsat-NDVI/HARV/2011/NDVI/309_HARV_ndvi_crop.tif"
</code></pre></div></div>

<p>Now we have a list of all GeoTIFF files in the <code class="highlighter-rouge">NDVI</code> directory for Harvard
Forest. Next, we will create a <code class="highlighter-rouge">RasterStack</code> from this list using the <code class="highlighter-rouge">stack()</code>
function.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create a raster stack of the NDVI time series</span><span class="w">
</span><span class="n">NDVI_HARV_stack</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stack</span><span class="p">(</span><span class="n">all_NDVI_HARV</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>We can explore the GeoTIFF tags (the embedded metadata) in a <code class="highlighter-rouge">stack</code> using the
same syntax that we used on single-band raster objects in <code class="highlighter-rouge">R</code> including: <code class="highlighter-rouge">crs()</code>
(coordinate reference system), <code class="highlighter-rouge">extent()</code> and <code class="highlighter-rouge">res()</code> (resolution; specifically
<code class="highlighter-rouge">yres()</code> and <code class="highlighter-rouge">xres()</code>).</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># view crs of rasters</span><span class="w">
</span><span class="n">crs</span><span class="p">(</span><span class="n">NDVI_HARV_stack</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CRS arguments:
 +proj=utm +zone=19 +ellps=WGS84 +units=m +no_defs 
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># view extent of rasters in stack</span><span class="w">
</span><span class="n">extent</span><span class="p">(</span><span class="n">NDVI_HARV_stack</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class       : Extent 
xmin        : 239415 
xmax        : 239535 
ymin        : 4714215 
ymax        : 4714365 
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># view the y resolution of our rasters</span><span class="w">
</span><span class="n">yres</span><span class="p">(</span><span class="n">NDVI_HARV_stack</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 30
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># view the x resolution of our rasters</span><span class="w">
</span><span class="n">xres</span><span class="p">(</span><span class="n">NDVI_HARV_stack</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 30
</code></pre></div></div>

<p>Notice that the CRS is <code class="highlighter-rouge">+proj=utm +zone=19 +ellps=WGS84 +units=m +no_defs</code>. The
CRS is in UTM Zone 19.  If you have completed the previous tutorials in
this
<a href="tutorial-series/raster-data-series/">raster data in <code class="highlighter-rouge">R</code> series </a>,
you may have noticed that the UTM zone for the NEON collected remote sensing
data was in Zone 18 rather than Zone 19. Why are the Landsat data in Zone 19?</p>

<figure>
    <a href="/images/dc-spatial-raster/UTM_zones_18-19.jpg">
    <img src="/images/dc-spatial-raster/UTM_zones_18-19.jpg" /></a>
    <figcaption> Landsat imagery swaths are over 170 km N-S and 180 km E-W. As
	a result a given image may overlap two UTM zones. The designated zone is
	determined by the zone that the majority of the image is in.  In this
	example, our point of interest is in UTM Zone 18 but the Landsat image will
	be classified as UTM Zone 19. Source: National Ecological Observatory
	Network (NEON).
    </figcaption>
</figure>

<p>The width of a Landsat scene is extremely wide - spanning over 170km north to
south and 180km east to west. This means that Landsat data often cover multiple
UTM zones. When the data are processed, the zone in which the majority of the
data cover, is the zone which is used for the final CRS. Thus, our field site at
Harvard Forest is located in UTM Zone 18, but the Landsat data is in a <code class="highlighter-rouge">CRS</code> of
UTM Zone 19.</p>

<blockquote class="challenge">
  <h2 id="challenge-raster-metadata">Challenge: Raster Metadata</h2>

  <p>Answer the following questions about our <code class="highlighter-rouge">RasterStack</code>.</p>

  <ol>
    <li>What is the CRS?</li>
    <li>What is the x and y resolution of the data?</li>
    <li>What units is the above resolution in?</li>
  </ol>

  <blockquote class="solution">
    <h2 id="answers">Answers</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 1. UTM zone 19 WGS 84</span><span class="w">
</span><span class="c1"># 2. 30x30 meters</span><span class="w">
</span><span class="c1"># 3. meters</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="plotting-time-series-data">Plotting Time Series Data</h2>
<p>Once we have created our <code class="highlighter-rouge">RasterStack</code>, we can visualize our data. We can use
the <code class="highlighter-rouge">plot()</code> command to quickly plot a <code class="highlighter-rouge">RasterStack</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># view a plot of all of the rasters</span><span class="w">
</span><span class="c1"># 'nc' specifies number of columns (we will have 13 plots)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">NDVI_HARV_stack</span><span class="p">,</span><span class="w">
     </span><span class="n">zlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1500</span><span class="p">,</span><span class="w"> </span><span class="m">10000</span><span class="p">),</span><span class="w">
     </span><span class="n">nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-plot-time-series-1.png" title="plot of chunk plot-time-series" alt="plot of chunk plot-time-series" style="display: block; margin: auto;" /></p>

<p>Have a look at the range of NDVI values observed in the plot above. We know that
the accepted values for NDVI range from 0-1. Why does our data range from
0 - 10,000?</p>

<h2 id="scale-factors">Scale Factors</h2>
<p>The metadata for this NDVI data specifies a scale factor: 10,000. A scale factor
is sometimes used to maintain smaller file sizes by removing decimal places.
Storing data in integer format keeps files sizes smaller.</p>

<p>Let’s apply the scale factor before we go any further. Conveniently, we can
quickly apply this factor using raster math on the entire stack as follows:</p>

<p><code class="highlighter-rouge">raster_stack_object_name / 10000</code></p>

<blockquote class="callout">
  <h2 id="data-tip">Data Tip</h2>
  <p>We can make this plot
even prettier by fixing the individual tile names, adding an plot title and by
using the (<code class="highlighter-rouge">levelplot</code>) function. This is covered in the NEON Data Skills
<a href="/R/Plot-Raster-Times-Series-Data-In-R/">Plot Time Series Rasters in R </a>
tutorial.</p>
</blockquote>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># apply scale factor to data</span><span class="w">
</span><span class="n">NDVI_HARV_stack</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">NDVI_HARV_stack</span><span class="o">/</span><span class="m">10000</span><span class="w">
</span><span class="c1"># plot stack with scale factor applied</span><span class="w">
</span><span class="c1"># apply scale factor to limits to ensure uniform plottin</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">NDVI_HARV_stack</span><span class="p">,</span><span class="w">
     </span><span class="n">zlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">.15</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w">
     </span><span class="n">nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-apply-scale-factor-1.png" title="plot of chunk apply-scale-factor" alt="plot of chunk apply-scale-factor" style="display: block; margin: auto;" /></p>

<h2 id="take-a-closer-look-at-our-data">Take a Closer Look at Our Data</h2>
<p>Let’s take a closer look at the plots of our data. Note that Massachusettes,
where the NEON Harvard Forest Field Site is located has a fairly consistent
fall, winter, spring and summer season where vegetation turns green in the
spring, continues to grow throughout the summer, and begins to change colors and
senesce in the fall through winter. Do you notice anything that seems unusual
about the patterns of greening and browning observed in the plots above?</p>

<p>Hint: the number after the “X” in each tile title is the Julian day which in
this case represents the number of days into each year. If you are unfamiliar
with Julian day, check out the NEON Data Skills
<a href="/R/julian-day-conversion/">Converting to Julian Day </a>
tutorial.</p>

<h2 id="view-distribution-of-raster-values">View Distribution of Raster Values</h2>
<p>In the above exercise, we viewed plots of our NDVI time series and noticed a
few images seem to be unusually light. However this was only a visual
representation of potential issues in our data. What is another way we can look
at these data that is quantitative?</p>

<p>Next we will use histograms to explore the distribution of NDVI values stored in
each raster.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># create histograms of each raster</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">NDVI_HARV_stack</span><span class="p">,</span><span class="w">
     </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-view-stack-histogram-1.png" title="plot of chunk view-stack-histogram" alt="plot of chunk view-stack-histogram" style="display: block; margin: auto;" /></p>

<p>It seems like things get green in the spring and summer like we expect, but the
data at Julian days 277 and 293 are unusual. It appears as if the vegetation got
green in the spring, but then died back only to get green again towards the end
of the year. Is this right?</p>

<h3 id="explore-unusual-data-patterns">Explore Unusual Data Patterns</h3>
<p>The NDVI data that we are using comes from 2011, perhaps a strong freeze around
Julian day 277 could cause a vegetation to senesce early, however in the eastern
United States, it seems unusual that it would proceed to green up again shortly
thereafter.</p>

<p>Let’s next view some temperature data for our field site to see whether there
were some unusual fluctuations that may explain this pattern of greening and
browning seen in the NDVI data.</p>

<p><img src="../fig/rmd-view-temp-data-1.png" title="plot of chunk view-temp-data" alt="plot of chunk view-temp-data" style="display: block; margin: auto;" /></p>

<p>There are no significant peaks or dips in the temperature during the late summer
or early fall time period that might account for patterns seen in the NDVI data.</p>

<p>What is our next step?</p>

<p>Let’s have a look at the source Landsat imagery that was partially used used to
derive our NDVI rasters to try to understand what appears to be outlier NDVI values.</p>

<blockquote class="challenge">
  <h2 id="challenge-examine-rgb-raster-files">Challenge: Examine RGB Raster Files</h2>

  <ol>
    <li>View the imagery located in the <code class="highlighter-rouge">/NEON-DS-Landsat-NDVI/HARV/2011</code> directory.</li>
    <li>Plot the RGB images for the Julian days 277 and 293 then plot and compare
those images to jdays 133 and 197.</li>
    <li>Does the RGB imagery from these two days explain the low NDVI values observed
on these days?</li>
  </ol>

  <p>HINT: if you want to plot 4 images in a tiled set, you can use
<code class="highlighter-rouge">par(mfrow=c(2, 2))</code> to create a 2x2 tiled layout. When you are done, be sure to
reset your layout using: <code class="highlighter-rouge">par(mfrow=c(1, 1))</code>.</p>

  <blockquote class="solution">
    <h2 id="answers-1">Answers</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="c1"># reset layout</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">

</span><span class="c1"># open up file for Jday 277</span><span class="w">
</span><span class="n">RGB_277</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
  </span><span class="n">stack</span><span class="p">(</span><span class="s2">"data/NEON-DS-Landsat-NDVI/HARV/2011/RGB/277_HARV_landRGB.tif"</span><span class="p">)</span><span class="w">

</span><span class="n">plotRGB</span><span class="p">(</span><span class="n">RGB_277</span><span class="p">)</span><span class="w">

</span><span class="c1"># open up file for jday 293</span><span class="w">
</span><span class="n">RGB_293</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
  </span><span class="n">stack</span><span class="p">(</span><span class="s2">"data/NEON-DS-Landsat-NDVI/HARV/2011/RGB/293_HARV_landRGB.tif"</span><span class="p">)</span><span class="w">

</span><span class="n">plotRGB</span><span class="p">(</span><span class="n">RGB_293</span><span class="p">)</span><span class="w">

</span><span class="c1"># view a few other images</span><span class="w">
</span><span class="c1"># open up file for jday 133</span><span class="w">
</span><span class="n">RGB_133</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
  </span><span class="n">stack</span><span class="p">(</span><span class="s2">"data/NEON-DS-Landsat-NDVI/HARV/2011/RGB/133_HARV_landRGB.tif"</span><span class="p">)</span><span class="w">

</span><span class="n">plotRGB</span><span class="p">(</span><span class="n">RGB_133</span><span class="p">,</span><span class="w">
        </span><span class="n">stretch</span><span class="o">=</span><span class="s2">"lin"</span><span class="p">)</span><span class="w">

</span><span class="c1"># open up file for jday 197</span><span class="w">
</span><span class="n">RGB_197</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
  </span><span class="n">stack</span><span class="p">(</span><span class="s2">"data/NEON-DS-Landsat-NDVI/HARV/2011/RGB/197_HARV_landRGB.tif"</span><span class="p">)</span><span class="w">

</span><span class="n">plotRGB</span><span class="p">(</span><span class="n">RGB_197</span><span class="p">,</span><span class="w">
        </span><span class="n">stretch</span><span class="o">=</span><span class="s2">"lin"</span><span class="p">)</span><span class="w">
</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w">
</span><span class="c1"># create list of files to make raster stack</span><span class="w">
</span><span class="c1"># RGB_HARV_allCropped &lt;-  list.files("NEON-DS-Landsat-NDVI/HARV/2011/RGB/",</span><span class="w">
</span><span class="c1">#                              full.names=TRUE,</span><span class="w">
</span><span class="c1">#                              pattern = ".tif$")</span><span class="w">


</span><span class="c1"># create a layout</span><span class="w">
</span><span class="c1"># par(mfrow=c(4, 4))</span><span class="w">

</span><span class="c1"># Super efficient code - plot using a loop</span><span class="w">
</span><span class="c1"># for (aFile in RGB_HARV_allCropped){</span><span class="w">
</span><span class="c1">#  NDVI.rastStack &lt;- stack(aFile)</span><span class="w">
</span><span class="c1">#  plotRGB(NDVI.rastStack, stretch="lin")</span><span class="w">
</span><span class="c1"># }</span><span class="w">

</span><span class="c1"># reset layout</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>

    <div class="error highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error: &lt;text&gt;:31:1: unexpected '&gt;'
30:         stretch="lin")
31: &gt;
    ^
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="explore-the-datas-source">Explore The Data’s Source</h2>
<p>The third challenge question, “Does the RGB imagery from these two days explain
the low NDVI values observed on these days?” highlights the importance of
exploring the source of a derived data product. In this case, the NDVI data
product was derived from (created using) Landsat imagery - specifically the red
and near-infrared bands.</p>

<p>When we look at the RGB collected at Julian days 277 and 293 we see that most of
the image is filled with clouds. The very low NDVI values resulted from cloud
cover — a common challenge that we encounter when working with satellite remote
sensing imagery.</p>


<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li>
</li>
    
  </ul>
</blockquote>

</article>

<div class="row">
  <div class="col-md-1">
    <h3>
      
      <a href="../11-vector-raster-integration/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
  </div>
  <div class="col-md-1">
    <h3>
      
      <a href="../13-plot-time-series-rasters-in-r/"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      
<footer>
  <div class="row">
    <div class="col-md-6" align="left">
      <h4>
	Copyright &copy; 2016–2018
	
	<a href="http://datacarpentry.org">Data Carpentry</a>
	
      </h4>
    </div>
    <div class="col-md-6" align="right">
      <h4>
	
	<a href="/edit/gh-pages/_episodes/12-time-series-raster.md">Edit on GitHub</a>
	
	/
	<a href="/blob/gh-pages/CONTRIBUTING.md">Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob/gh-pages/CITATION">Cite</a>
	/
	<a href="mailto:lessons@software-carpentry.org">Contact</a>
      </h4>
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
